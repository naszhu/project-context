!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PodsProxy=t():e.PodsProxy=t()}(window,(function(){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(4);s.__exportStar(r(5),t),s.__exportStar(r(6),t)},function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(7),t)},function(e,t,r){"use strict";var s,o="object"==typeof Reflect?Reflect:null,n=o&&"function"==typeof o.apply?o.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};s=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var d=10;function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function c(e,t,r,s){var o,n,i,a;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),n=e._events),i=n[t]),void 0===i)i=n[t]=r,++e._eventsCount;else if("function"==typeof i?i=n[t]=s?[r,i]:[i,r]:s?i.unshift(r):i.push(r),(o=l(e))>0&&i.length>o&&!i.warned){i.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=i.length,a=d,console&&console.warn&&console.warn(a)}return e}function p(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,n(this.listener,this.target,e))}function u(e,t,r){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=p.bind(s);return o.listener=r,s.wrapFn=o,o}function m(e,t,r){var s=e._events;if(void 0===s)return[];var o=s[t];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):f(o,o.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),s=0;s<t;++s)r[s]=e[s];return r}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");d=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var s="error"===e,o=this._events;if(void 0!==o)s=s&&void 0===o.error;else if(!s)return!1;if(s){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var a=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw a.context=i,a}var d=o[e];if(void 0===d)return!1;if("function"==typeof d)n(d,this,t);else{var l=d.length,c=f(d,l);for(r=0;r<l;++r)n(c[r],this,t)}return!0},a.prototype.addListener=function(e,t){return c(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return c(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,u(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,u(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,s,o,n,i;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(s=this._events))return this;if(void 0===(r=s[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,n=r.length-1;n>=0;n--)if(r[n]===t||r[n].listener===t){i=r[n].listener,o=n;break}if(o<0)return this;0===o?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,o),1===r.length&&(s[e]=r[0]),void 0!==s.removeListener&&this.emit("removeListener",e,i||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,s;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var o,n=Object.keys(r);for(s=0;s<n.length;++s)"removeListener"!==(o=n[s])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},a.prototype.listeners=function(e){return m(this,e,!0)},a.prototype.rawListeners=function(e){return m(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},a.prototype.listenerCount=h,a.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},,function(e,t,r){"use strict";r.r(t),r.d(t,"__extends",(function(){return o})),r.d(t,"__assign",(function(){return n})),r.d(t,"__rest",(function(){return i})),r.d(t,"__decorate",(function(){return a})),r.d(t,"__param",(function(){return d})),r.d(t,"__esDecorate",(function(){return l})),r.d(t,"__runInitializers",(function(){return c})),r.d(t,"__propKey",(function(){return p})),r.d(t,"__setFunctionName",(function(){return u})),r.d(t,"__metadata",(function(){return m})),r.d(t,"__awaiter",(function(){return h})),r.d(t,"__generator",(function(){return f})),r.d(t,"__createBinding",(function(){return g})),r.d(t,"__exportStar",(function(){return _})),r.d(t,"__values",(function(){return I})),r.d(t,"__read",(function(){return y})),r.d(t,"__spread",(function(){return C})),r.d(t,"__spreadArrays",(function(){return S})),r.d(t,"__spreadArray",(function(){return P})),r.d(t,"__await",(function(){return E})),r.d(t,"__asyncGenerator",(function(){return T})),r.d(t,"__asyncDelegator",(function(){return w})),r.d(t,"__asyncValues",(function(){return R})),r.d(t,"__makeTemplateObject",(function(){return v})),r.d(t,"__importStar",(function(){return M})),r.d(t,"__importDefault",(function(){return b})),r.d(t,"__classPrivateFieldGet",(function(){return x})),r.d(t,"__classPrivateFieldSet",(function(){return W})),r.d(t,"__classPrivateFieldIn",(function(){return A})),r.d(t,"__addDisposableResource",(function(){return H})),r.d(t,"__disposeResources",(function(){return D}));var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var n=function(){return(n=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]])}return r}function a(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i}function d(e,t){return function(r,s){t(r,s,e)}}function l(e,t,r,s,o,n){function i(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,d=s.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?s.static?e:e.prototype:null,p=t||(c?Object.getOwnPropertyDescriptor(c,s.name):{}),u=!1,m=r.length-1;m>=0;m--){var h={};for(var f in s)h[f]="access"===f?{}:s[f];for(var f in s.access)h.access[f]=s.access[f];h.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");n.push(i(e||null))};var g=(0,r[m])("accessor"===d?{get:p.get,set:p.set}:p[l],h);if("accessor"===d){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(a=i(g.get))&&(p.get=a),(a=i(g.set))&&(p.set=a),(a=i(g.init))&&o.unshift(a)}else(a=i(g))&&("field"===d?o.unshift(a):p[l]=a)}c&&Object.defineProperty(c,s.name,p),u=!0}function c(e,t,r){for(var s=arguments.length>2,o=0;o<t.length;o++)r=s?t[o].call(e,r):t[o].call(e);return s?r:void 0}function p(e){return"symbol"==typeof e?e:"".concat(e)}function u(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function m(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e,t,r,s){return new(r||(r=Promise))((function(o,n){function i(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))}function f(e,t){var r,s,o,n,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(a){return function(d){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,a[0]&&(i=0)),i;)try{if(r=1,s&&(o=2&a[0]?s.return:a[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,a[1])).done)return o;switch(s=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,d])}}}var g=Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]};function _(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||g(t,e,r)}function I(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,o,n=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(e){o={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function C(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function S(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var s=Array(e),o=0;for(t=0;t<r;t++)for(var n=arguments[t],i=0,a=n.length;i<a;i++,o++)s[o]=n[i];return s}function P(e,t,r){if(r||2===arguments.length)for(var s,o=0,n=t.length;o<n;o++)!s&&o in t||(s||(s=Array.prototype.slice.call(t,0,o)),s[o]=t[o]);return e.concat(s||Array.prototype.slice.call(t))}function E(e){return this instanceof E?(this.v=e,this):new E(e)}function T(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,o=r.apply(e,t||[]),n=[];return s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(e){o[e]&&(s[e]=function(t){return new Promise((function(r,s){n.push([e,t,r,s])>1||a(e,t)}))})}function a(e,t){try{(r=o[e](t)).value instanceof E?Promise.resolve(r.value.v).then(d,l):c(n[0][2],r)}catch(e){c(n[0][3],e)}var r}function d(e){a("next",e)}function l(e){a("throw",e)}function c(e,t){e(t),n.shift(),n.length&&a(n[0][0],n[0][1])}}function w(e){var t,r;return t={},s("next"),s("throw",(function(e){throw e})),s("return"),t[Symbol.iterator]=function(){return this},t;function s(s,o){t[s]=e[s]?function(t){return(r=!r)?{value:E(e[s](t)),done:!1}:o?o(t):t}:o}}function R(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=I(e),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise((function(s,o){!function(e,t,r,s){Promise.resolve(s).then((function(t){e({value:t,done:r})}),t)}(s,o,(t=e[r](t)).done,t.value)}))}}}function v(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var O=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function M(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&g(t,e,r);return O(t,e),t}function b(e){return e&&e.__esModule?e:{default:e}}function x(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)}function W(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r}function A(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function H(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var s;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=t[Symbol.asyncDispose]}if(void 0===s){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=t[Symbol.dispose]}if("function"!=typeof s)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:s,async:r})}else r&&e.stack.push({async:!0});return t}var L="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var s=new Error(r);return s.name="SuppressedError",s.error=e,s.suppressed=t,s};function D(e){function t(t){e.error=e.hasError?new L(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function r(){for(;e.stack.length;){var s=e.stack.pop();try{var o=s.dispose&&s.dispose.call(s.value);if(s.async)return Promise.resolve(o).then(r,(function(e){return t(e),r()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()}t.default={__extends:o,__assign:n,__rest:i,__decorate:a,__param:d,__metadata:m,__awaiter:h,__generator:f,__createBinding:g,__exportStar:_,__values:I,__read:y,__spread:C,__spreadArrays:S,__spreadArray:P,__await:E,__asyncGenerator:T,__asyncDelegator:w,__asyncValues:R,__makeTemplateObject:v,__importStar:M,__importDefault:b,__classPrivateFieldGet:x,__classPrivateFieldSet:W,__classPrivateFieldIn:A,__addDisposableResource:H,__disposeResources:D}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeGate=void 0;var s=function(){function e(){}return e.initSettings=function(e){e.disabledChangeGates&&(this.m_disabledChangeGateList=e.disabledChangeGates.split(";"))},e.isChangeGateEnabled=function(e){return!!e&&(!this.m_disabledChangeGateList||this.m_disabledChangeGateList.indexOf(e)<0)},e.m_disabledChangeGateList=[""],e}();t.ChangeGate=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Settings=void 0;var s=function(){function e(){}return e.load=function(t){for(var r in t)e.m_settings[r]=t[r]},e.readBooleanOrDefault=function(t,r){var s=void 0===e.m_settings?"":typeof e.m_settings[t];return"string"===s?"true"===e.m_settings[t].toLowerCase():"boolean"===s?e.m_settings[t]:r},e.readNumberOrDefault=function(t,r){var s=void 0===e.m_settings?"":typeof e.m_settings[t];return"string"===s||"number"===s?Number(e.m_settings[t]):r},e.readStringOrDefault=function(t,r){return void 0===e.m_settings||"string"!=typeof e.m_settings[t]?r:e.m_settings[t]},e.addOrUpdateSettingsFromUrl=function(t,r){var s=r.get("wdset");if(!s)return t;for(var o=0,n=s.split(",");o<n.length;o++){var i=n[o].split(":"),a=i[0].split("."),d=a[0],l=a[1],c=i[1];l&&c&&e.addOrUpdateSetting(t,d,l,c)}return t},e.addOrUpdateSetting=function(e,t,r,s){"__proto__"!==t&&(e[t]||(e[t]={}),e[t][r]=s)},e.m_settings={},e}();t.Settings=s},function(e,t,r){"use strict";var s,o,n,i,a,d;r.r(t),r.d(t,"exposed",(function(){return S})),r.d(t,"setupGlobals_PodsProxy",(function(){return P})),r.d(t,"PodsProxy",(function(){return E})),r.d(t,"PodsProxyRequestType",(function(){return s})),r.d(t,"PodsProxyRequestStageType",(function(){return o})),r.d(t,"PodsProxyConstants",(function(){return l})),r.d(t,"ClientColorSettings",(function(){return n})),r.d(t,"SlideImageAppendOption",(function(){return i})),r.d(t,"GetRequestItemIds",(function(){return c})),r.d(t,"ErrorCode",(function(){return a})),r.d(t,"ErrorCategory",(function(){return d})),r.d(t,"ItemType",(function(){return p})),function(e){e.getPresInfoAsync="getPresInfoAsync",e.getItemsPresInfoAndSlideInfoAsync="getItemsPresInfoAndSlideInfoAsync",e.getItemsSlideInfosAsync="getItemsSlideInfosAsync",e.getSlideInfosAsync="getSlideInfosAsync"}(s||(s={})),function(e){e.GetItemsCall="GetItemsCall",e.DownloadResponseStream="DownloadResponseStream",e.ParseMultipartResponse="ParseMultipartResponse"}(o||(o={}));class l{}l.unknown="unknown",l.ErrorCode="ErrorCode",l.ErrorCategory="ErrorCategory",l.errorCategory="errorCategory",l.errorCode="errorCode",l.IsIntentional="IsIntentional",l.isIntentional="isIntentional",l.XCorrelationId="X-CorrelationId",l.ContentType="Content-Type",l.ContentLength="Content-Length",l.ContenEncoding="Content-Encoding",l.TransferEncoding="Transfer-Encoding",l.XusedOutputCache="X-usedOutputCache",l.Xnewsnapurl="x-newsnapurl",l.ContentDisposition="Content-Disposition",l.CallerCorrelationId="CallerCorrelationId",l.action="action",l.parser="parser",l.server="server",l.callId="callId",l.dateHeader="x-ms-date",l.clientTimeoutHeader="x-ms-client-timeout",l.clientRequestIdHeader="x-ms-client-request-id",l.newSnapUrlHeader="x-newsnapurl",l.correlationId="correlationId",l.firstResponseCheck="firstResponseCheck",l.fetchBoundary="fetchBoundary",l.downloadResponse="downloadResponse",l.parserCallback="parserCallback",l.createResponse="createResponse",l.contentLength="contentLength",l.usedOutputCache="usedOutputCache",l.itemUsedOutputCacheMap="itemUsedOutputCacheMap",l.podsProxyCallSuceeded="podsProxyCallSuceeded",l.PriorityHint="PriorityHint",l.RequestInfo="RequestInfo",l.ResponseHeaders="ResponseHeaders",l.IsBootRequest="IsBootRequest",function(e){e.None="None",e.BlackColorTheme="#FFFFFF_#000000_#FFFF00"}(n||(n={})),function(e){e[e.None=0]="None",e[e.All=1]="All",e[e.Partial=2]="Partial",e[e.Embed=3]="Embed"}(i||(i={}));class c{}c.PresInfoMetaData="presinfo/metadata",c.PresinfoslimSlideOrder="presinfo/slimSlideOrder",c.slideInfoIndex="pres/sldIdx",c.slideInfoSid="pres/sldSid",c.slideNotesIndex="pres/NotesSldIdx",c.slideNotesSid="pres/NotesSldSid",c.slideCommentsIndex="pres/CommentsSldIdx",c.slideCommentsSid="pres/CommentsSldSid",c.slideMetadataIndex="pres/SlideMetadatasldIdx",c.slideMetadataSid="pres/SlideMetadataSldSid",c.slideAccessibilityModelIndex="pres/SlideAccessibilityModelSldIdx",c.slideAccessibilityModelSid="pres/SlideAccessibilityModelSldSid",function(e){e.ErrorRESERVEDSuccess="ErrorRESERVEDSuccess",e.ErrorRESERVEDItemFailed="ErrorRESERVEDItemFailed",e.ErrorDownloadResponseStreamTimeout="ErrorDownloadResponseStreamTimeout",e.ErrorRequestFailed="ErrorRequestFailed",e.ErrorRequestFailedServiceUnavailable="ErrorRequestFailedServiceUnavailable",e.ErrorRequestFailedBadGateway="ErrorRequestFailedBadGateway",e.ErrorRequestFailedGatewayTimeout="ErrorRequestFailedGatewayTimeout",e.ErrorRequestFailedServerNotFound="ErrorRequestFailedServerNotFound",e.ErrorContentDispositionHeaderNotValid="ErrorContentDispositionHeaderNotValid",e.ErrorItemNameNotValid="ErrorItemNameNotValid",e.ErrorResponseNotValid="ErrorResponseNotValid",e.ErrorCannotParseResponse="ErrorCannotParseResponse",e.ErrorRequestTimeout="ErrorRequestTimeout",e.ErrorFailedToFetch="ErrorFailedToFetch",e.ErrorRequestCanceled="ErrorRequestCanceled",e.ErrorRequestAbort="ErrorRequestAbort",e.ErrorConnectionLost="ErrorConnectionLost",e.ErrorSoftwareConnectionAbort="ErrorSoftwareConnectionAbort",e.ErrorFailedToDownloadFile="ErrorFailedToDownloadFile",e.ErrorFileDownloadNetworkError="ErrorFileDownloadNetworkError",e.ErrorFileDownloadResourceInconsistent="ErrorFileDownloadResourceInconsistent",e.ErrorResourceInconsistentResnaptimeout="ErrorResourceInconsistentResnaptimeout",e.ErrorResourceInconsistentResnapNotStarted="ErrorResourceInconsistentResnapNotStarted",e.ErrorResourceInconsistentResnapUrlMissing="ErrorResourceInconsistentResnapUrlMissing",e.ServerErrorFileDownloadResourceInconsistent="ServerErrorFileDownloadResourceInconsistent",e.ServerErrorResourceInconsistentResnaptimeout="ServerErrorResourceInconsistentResnaptimeout",e.ServerErrorResourceInconsistentResnapNotStarted="ServerErrorResourceInconsistentResnapNotStarted",e.ServerErrorResourceInconsistentResnapUrlMissing="ServerErrorResourceInconsistentResnapUrlMissing"}(a||(a={})),function(e){e.ErrorRESERVEDSuccess="ErrorRESERVEDSuccess",e.BadRequest="BadRequest",e.Fatal="Fatal",e.NotSupported="NotSupported",e.Transient="Transient"}(d||(d={}));class p{}p.JsonType="application/json",p.ImagePng="image/png",p.ImageJpg="image/jpg",p.PlainTextType="text/plain";class u{async processMultipartResponse(e,t,r){if(null==e)throw"multipartContentBuffer is empty";try{const s=new TextDecoder("utf-8").decode(e);this.parseMultipart(s,t).forEach(e=>{const t=this.parseResponsePart(e);r(t)})}catch(e){const t={Err:new Error(e)};r(t)}}fetchBoundary(e){const t=e.split("boundary=");if(2===t.length)return t[1];throw"No Boundary"}async processMultipartBinaryResponse(e,t,r){if(!e)throw"multipartContentBufferOrStream is empty";let s,o="",n=void 0,i=0,a=[],d=null;const l=e instanceof Uint8Array;try{for(;;){if(l)s=e;else{const{done:t,value:r}=await e.read();if(t)break;s=r}for(const e of s){const s=10===e||13===e,l=10===e&&13===d,c=10===d&&13===e;if(a.push(e),s||(o+=String.fromCharCode(e)),0===i&&l)"--"+t===o&&(i=1,o="",a=[]);else if(1===i&&c)n=new Uint8Array(a),i=2,o="",a=[];else if(2===i&&l)i=3,o="",a=[];else if(3===i){if(o.length>t.length+4&&(o=""),"--"+t===o){const e=a.length-o.length,t=a.slice(0,e-1);i=1;r({Headers:this.processHeader(n),Body:new Uint8Array(t)}),o="",n=void 0,a=[]}l&&(o="")}d=e}if(l)break}}catch(e){r({Err:new Error(e)})}}parseMultipart(e,t){const r="--"+t;return e.split(r).map(e=>e.trim()).filter(e=>""!==e&&"--"!==e)}parseResponsePart(e){const t=this.parseResponseHeaderFromPart(e).split("\n"),r=new Map;t.forEach(e=>{const t=e.split(": ");2===t.length&&r.set(t[0],t[1])});const s=this.parseResponseBodyFromPart(e),o=(new TextEncoder).encode(s);return{Headers:r,Body:o}}parseResponseBodyFromPart(e){const t=e.split("\n\r\n");if(2===t.length)return t[1];throw"No response Body"}parseResponseHeaderFromPart(e){const t=e.split("\n\r\n");if(2===t.length)return t[0];throw"No response Headers"}processHeader(e){const t=new Map;if(e){let r="";for(let t=0;t<e.byteLength;t+=1)r+=String.fromCharCode(e[t]);r.split("\n").forEach(e=>{const r=e.split(": ");2===r.length&&t.set(r[0],r[1])})}return t}}var m,h,f=r(0),g=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e.prototype.setCorrelationId=function(){},e}(),_=new(function(){function e(){this.externalLogger=new g}return e.prototype.setCorrelationId=function(e){this.externalLogger.setCorrelationId(e)},e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,r,s){this.externalLogger.sendTraceTag(e,t,r,s)},e.prototype.debugAssertTag=function(e,t,r,s){this.externalLogger.debugAssertTag(e,t,r,s)},e.prototype.shipAssertTag=function(e,t,r,s){this.externalLogger.shipAssertTag(e,t,r,s)},e}());!function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_MSOSP_FileMenuCommands=202]="msoulscat_MSOSP_FileMenuCommands",e[e.msoulscat_MSOSP_AddInCommands=220]="msoulscat_MSOSP_AddInCommands",e[e.msoulscat_MSOSP_OTelJS=225]="msoulscat_MSOSP_OTelJS",e[e.msoulscat_MSOSP_OTelJSInWebWoker=227]="msoulscat_MSOSP_OTelJSInWebWoker",e[e.msoulscat_MSOSP_OTelJSWebWorkerPrototype=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WacFeedback=356]="msoulscat_Wac_WacFeedback",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_Dictation=394]="msoulscat_Wac_Dictation",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptAnimation=800]="msoulscat_Wac_PptAnimation",e[e.msoulscat_Wac_PptLive=833]="msoulscat_Wac_PptLive",e[e.msoulscat_Wac_PptMWeb=834]="msoulscat_Wac_PptMWeb",e[e.msoulscat_Wac_PptGc2General=835]="msoulscat_Wac_PptGc2General",e[e.msoulscat_Wac_PptGc2GraphicHost=836]="msoulscat_Wac_PptGc2GraphicHost",e[e.msoulscat_Wac_PptGc2Operation=837]="msoulscat_Wac_PptGc2Operation",e[e.msoulscat_Wac_PptDataSync=844]="msoulscat_Wac_PptDataSync",e[e.msoulscat_Wac_PptFluidRuntime=848]="msoulscat_Wac_PptFluidRuntime",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_PptSlideshow=830]="msoulscat_Wac_PptSlideshow",e[e.msoulscat_Wac_PptView=822]="msoulscat_Wac_PptView",e[e.msoulscat_Wac_PptVideos=846]="msoulscat_Wac_PptVideos",e[e.msoulscat_Uci_Insights=1303]="msoulscat_Uci_Insights",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_OAuth=3e3]="msoulscat_Wac_OAuth",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard",e[e.msoulscat_Wac_CatchUpFlyout=3012]="msoulscat_Wac_CatchUpFlyout",e[e.msoulscat_Wac_WordDesigner=3016]="msoulscat_Wac_WordDesigner",e[e.msoulscat_Wac_ModernFontPicker=3021]="msoulscat_Wac_ModernFontPicker",e[e.msoulscat_Wac_UnifiedUiHost=3027]="msoulscat_Wac_UnifiedUiHost",e[e.msoulscat_Wac_EquationTools=3033]="msoulscat_Wac_EquationTools",e[e.msoulscat_Osf_Latency=1401]="msoulscat_Osf_Latency",e[e.msoulscat_Osf_Notification=1402]="msoulscat_Osf_Notification",e[e.msoulscat_Osf_Runtime=1403]="msoulscat_Osf_Runtime",e[e.msoulscat_Wac_AiMaker=3041]="msoulscat_Wac_AiMaker",e[e.msoulscat_Wac_AiRewrite=3043]="msoulscat_Wac_AiRewrite",e[e.msoulscat_Wac_AiInsert=3044]="msoulscat_Wac_AiInsert",e[e.msoulscat_Wac_AiSummarize=3047]="msoulscat_Wac_AiSummarize",e[e.msoulscat_Wac_CopilotCompose=3048]="msoulscat_Wac_CopilotCompose",e[e.msoulscat_Wac_Skittles=3049]="msoulscat_Wac_Skittles"}(m||(m={})),function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Important=20]="Important",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(h||(h={}));var I=r(2);class y{constructor(e,t,r,s){this.parsedResponse={slideOrder:[],slideAllInfo:[]},this.m_settings=e,this.m_responses=t,this.m_perfDictionary=r,this.m_parsedBasedResponse=s}parsePart(e){if(e&&e.Headers){this.m_perfDictionary[l.parserCallback]?(this.m_perfDictionary[l.parserCallback].callCounter=this.m_perfDictionary[l.parserCallback].callCounter+1,this.m_perfDictionary[l.parserCallback].lastCallStart=E.performanceNowTrimmed()):this.m_perfDictionary[l.parserCallback]={lastCallStart:E.performanceNowTrimmed(),lastCallEnd:E.performanceNowTrimmed(),callCounter:0,slidesHaveImages:[],slidesHaveImageResources:[]};const t=e.Headers.get(l.ContentDisposition),r=e.Headers.get(l.ContentType);this.m_parsedBasedResponse.usedOutputCache=e.Headers.get(l.XusedOutputCache),this.m_parsedBasedResponse.newSnapUrl=e.Headers.get(l.Xnewsnapurl);const s=e.Headers.get(l.ErrorCode)||a.ErrorRESERVEDSuccess,o=e.Headers.get(l.ErrorCategory)||d.ErrorRESERVEDSuccess,n=e.Headers.get(l.XusedOutputCache);if(t){let i;const d=t.indexOf("pres%2fSlideMetadatasldIdx")>0;try{i=decodeURIComponent(t.substring(t.indexOf("name=")+5).trim())}catch(e){_.sendTraceTag(595641600,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy::parseMultipartResponse - partResponse Error:"+e)}if(i){if(this.m_parsedBasedResponse.itemErrorCodeMap||(this.m_parsedBasedResponse.itemErrorCodeMap=new Map),this.m_parsedBasedResponse.itemErrorCategoryMap||(this.m_parsedBasedResponse.itemErrorCategoryMap=new Map),this.m_parsedBasedResponse.itemUsedOutputCacheMap||(this.m_parsedBasedResponse.itemUsedOutputCacheMap=new Map),this.m_parsedBasedResponse.itemErrorCodeMap.set(i,s),this.m_parsedBasedResponse.itemErrorCategoryMap.set(i,o),n&&this.m_parsedBasedResponse.itemUsedOutputCacheMap.set(i,n),s&&s.trim().toLowerCase()===a.ErrorRESERVEDSuccess.toLowerCase())if(t.indexOf("presinfo%2fslimSlideOrder")>0){const t=JSON.parse(new TextDecoder("utf-8").decode(e.Body));for(const e of t)this.parsedResponse.slideOrder.push({sid:e,cid:0})}else if(t.indexOf("presinfo%2fmetadata")>0){const t=JSON.parse(new TextDecoder("utf-8").decode(e.Body)),r=[],s=[];for(const e of t.SidSlideOrder)r.push({sid:e,cid:0});if(t.SidHiddenSlides)for(const e of t.SidHiddenSlides)s.push({sid:e,cid:0});let o={Item:null};t.SlideShowProperties.Item||(o={Item:null}),t.SlideShowProperties.Item.s?o={Item:{sid:t.SlideShowProperties.Item.s}}:t.SlideShowProperties.Item.st&&(o={Item:{start:t.SlideShowProperties.Item.st,end:t.SlideShowProperties.Item.end}});const n={SlideOrder:r,HiddenSlideOrder:s,SlideEmuWidth:t.SlideEmuWidth,SlideEmuHeight:t.SlideEmuHeight,ViewScalingFactor:t.ViewScalingFactor,SlideShowProperties:o,Sections:t.Sections};this.parsedResponse.slideAllInfo.push(n)}else if((t.indexOf("pres%2fsldSid")>0||t.indexOf("pres%2fsldIdx")>0)&&r&&y.getSupportedImageType(r)){const s=y.getSlideKeyFromHeader(t,t.indexOf("pres%2fsldSid")>0?"sldSid":"sldIdx");let o="";for(let t=0;t<e.Body.length;t+=1)o+=String.fromCharCode(e.Body[t]);const n=`data:${y.getSupportedImageType(r)};base64, ${btoa(o)}`;this.m_perfDictionary[l.parserCallback].slidesHaveImages.push(s),this.m_responses[s]||(this.m_responses[s]={ID:{sid:s,cid:0}}),this.m_responses[s].SlideImageData=n}else if((t.indexOf("pres%2fsldSid")>0||t.indexOf("pres%2fsldIdx")>0)&&r&&-1!==r.indexOf("application/json")){const r=y.getSlideKeyFromHeader(t,t.indexOf("pres%2fsldSid")>0?"sldSid":"sldIdx"),s=JSON.parse(new TextDecoder("utf-8").decode(e.Body));f.ChangeGate.isChangeGateEnabled("PodsProxy.getItemsMediaResourceMapping")&&s.mediaUrls?(this.m_responses[r]||(this.m_responses[r]={ID:{sid:s.slideShowInfo.sld[0].id,cid:0}}),this.m_responses[r].SlideShowInfo=s.slideShowInfo,this.m_responses[r].MediaUrls=s.mediaUrls):(this.m_responses[r]||(this.m_responses[r]={ID:{sid:s.sld[0].id,cid:0}}),this.m_responses[r].SlideShowInfo=s)}else if(t.indexOf("pres%2fNotesSldSid")>0||t.indexOf("pres%2fNotesSldIdx")>0){const r=y.getSlideKeyFromHeader(t,t.indexOf("pres%2fNotesSldSid")>0?"NotesSldSid":"NotesSldIdx"),s=new TextDecoder("utf-8").decode(e.Body);this.m_responses[r]||(this.m_responses[r]={ID:{sid:r,cid:0}}),this.m_responses[r].NoteHtml=s}else if(t.indexOf("pres%2fCommentsSldSid")>0||t.indexOf("pres%2fCommentsSldIdx")>0){const r=y.getSlideKeyFromHeader(t,t.indexOf("pres%2fCommentsSldSid")>0?"CommentsSldSid":"CommentsSldIdx"),s=JSON.parse(new TextDecoder("utf-8").decode(e.Body));this.m_responses[r]||(this.m_responses[r]={ID:{sid:r,cid:0}}),this.m_responses[r].Comments=s}else if(t.indexOf("pres%2fSlideMetadataSldSid")>0||d){const r=y.getSlideKeyFromHeader(t,t.indexOf("pres%2fSlideMetadataSldSid")>0?"SlideMetadataSldSid":"SlideMetadatasldIdx"),s=JSON.parse(new TextDecoder("utf-8").decode(e.Body));this.m_responses[r]||(this.m_responses[r]={ID:s.ID}),this.m_responses[r].Title=s.Title,this.m_responses[r].HasAnimation=s.HasAnimation,this.m_responses[r].Hidden=s.Hidden,this.m_responses[r].HasTransition=s.HasTransition}else if(t.indexOf("pres%2fSlideAccessibilityModelSldSid")>0||t.indexOf("pres%2fSlideAccessibilityModelSldIdx")>0){const r=y.getSlideKeyFromHeader(t,t.indexOf("pres%2fSlideAccessibilityModelSldSid")>0?"SlideAccessibilityModelSldSid":"SlideAccessibilityModelSldIdx"),s=JSON.parse(new TextDecoder("utf-8").decode(e.Body));this.m_responses[r]||(this.m_responses[r]={ID:s.ID}),this.m_responses[r].AccessibilityModel=s.AccessibilityModel}else if(t.indexOf("Res%2fSldSid")>0&&r&&y.getSupportedImageType(r)){const s=y.extractStringInBetweenStrings(t,"Res%2fSldSid","%2f"),o=y.extractStringInBetweenStrings(t,"filename=","\r");if(s&&o){const t={sid:+s,cid:0},n=y.getSupportedImageType(r);let i,a;if(e.Body)if(this.m_settings.allowImagesAsBinary)i={Id:o,Base64:"",Binary:e.Body,MimeType:n,ByteCount:e.Body.length};else{let t="";for(let r=0;r<e.Body.length;r+=1)t+=String.fromCharCode(e.Body[r]);const r=`data:${n};base64,${btoa(t)}`;i={Id:o,Base64:r,MimeType:n,ByteCount:r.length}}else _.sendTraceTag(529331297,m.msoulscat_Wac_PptSession,h.Error,`PodsProxy::parseMultipartResponse - Body is undefined. slideId:${s}, resourceId:${o}`),i={Id:o,Base64:"",MimeType:n,ByteCount:0};this.m_perfDictionary[l.parserCallback].slidesHaveImageResources.push(t.sid);for(const[,e]of Object.entries(this.m_responses))e.ID&&e.ID.sid===t.sid&&(a=e);a?a.ResourceData?a.ResourceData.push(i):a.ResourceData=[i]:this.m_responses[t.sid]={ID:t,ResourceData:[i]}}else _.sendTraceTag(595628568,m.msoulscat_Wac_PptSession,h.Error,`PodsProxy::parseMultipartResponse - Cannot get slideId or resourceId from header. slideId:${s}, resourceId:${o}`),this.m_parsedBasedResponse.responseErrorCode=a.ErrorResponseNotValid}}else this.m_parsedBasedResponse.responseErrorCode=a.ErrorItemNameNotValid}else e.Headers.get("x-ms-content-id")&&(this.m_parsedBasedResponse.itemErrorCodeMap||(this.m_parsedBasedResponse.itemErrorCodeMap=new Map),this.m_parsedBasedResponse.itemErrorCategoryMap||(this.m_parsedBasedResponse.itemErrorCategoryMap=new Map),this.m_parsedBasedResponse.itemErrorCodeMap.set(e.Headers.get("x-ms-content-id"),s),this.m_parsedBasedResponse.itemErrorCategoryMap.set(e.Headers.get("x-ms-content-id"),o)),this.m_parsedBasedResponse.responseErrorCode=a.ErrorContentDispositionHeaderNotValid;this.m_perfDictionary[l.parserCallback].lastCallEnd=E.performanceNowTrimmed()}else this.m_parsedBasedResponse.responseErrorCode=a.ErrorResponseNotValid;e.Err&&(this.m_parsedBasedResponse.responseErrorCode=a.ErrorResponseNotValid,_.sendTraceTag(595687003,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy::parseMultipartResponse - partResponse Error:"+e.Err))}static getSupportedImageType(e){return E.s_supportedImageType.find(t=>-1!==e.indexOf(t))||""}static getSlideKeyFromHeader(e,t){const r=new RegExp(`.*${t}(.*)`);if(!e)return _.sendTraceTag(529331298,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy::getSlideLocationFromHeader - header is null."),-1;const s=r.exec(e);return null!=s&&s.length>=2?+s[1]:(_.sendTraceTag(529331299,m.msoulscat_Wac_PptSession,h.Error,`PodsProxy::getSlideLocationFromHeader - regex result is null header:${e}, itemId: ${t}`),-1)}static extractStringInBetweenStrings(e,t,r){const s=e.indexOf(t)+t.length,o=r?e.indexOf(r,s):-1;return-1===o?e.substring(s):e.substring(s,o)}}var C=r(1);const S={};function P(e){e.logger&&_.setLogger(e.logger),e.settings&&C.Settings.load(e.settings?e.settings.podsproxy:{}),e.disabledChangeGates&&f.ChangeGate.initSettings({disabledChangeGates:e.disabledChangeGates||""}),e.exposed&&(e.exposed.svm=S)}class E{constructor(e,t,r,s,o,n,i){if(this.events=new I.EventEmitter,this.m_requestHeaders=new Headers,this.m_itemsList=new Array,this.m_multipartParser=new u,_.setLogger(s),_.sendTraceTag(595686994,m.msoulscat_Wac_PptSession,e&&t&&t.DownloadUrl&&r&&t.DocID?h.Info:h.Warning,`PodsProxy::constructor - podsUrl:${e}, fileExtension:${r}, docId:${t.DocID}}`),_.sendTraceTag(508638473,m.msoulscat_Wac_PptSession,h.Info,`PodsProxy::constructor - presentUrl:${o}}`),this.m_podsUrl=e,this.m_presentUrl=o,this.m_settings=i||{timeout:3e4,throwHttpErrors:!0},f.ChangeGate.initSettings({disabledChangeGates:this.m_settings.disabledChangeGates||""}),n&&n.forEach((e,t)=>{this.m_requestHeaders.append(t,e)}),this.m_getPresInfoRequest={Source:t,FileExtension:r||"pptx"},this.m_getItemsRequest={Source:t,FileExtension:r||"pptx",Items:this.m_itemsList},this.m_imageInputProperties={ClientColorSettings:void 0,IsHighContrast:void 0,ColorMode:void 0,ClientWidth:void 0,ClientHeight:void 0,MinClientWidth:void 0,MinClientHeight:void 0,MaxClientWidth:void 0,MaxClientHeight:void 0,TranslateLanguage:void 0},this.m_imageOptions={InputProperties:this.m_imageInputProperties},this.m_slideInfoInputProperties={ClientWidth:void 0,ClientHeight:void 0,IsHighContrast:void 0,ColorMode:void 0,ClientColorSettings:void 0,TranslateLanguage:void 0,LocaleName:void 0},this.m_slideInfoOptions={InputProperties:this.m_slideInfoInputProperties},this.m_slideResourceInputProperties={ClientWidth:void 0,ClientHeight:void 0,IsHighContrast:void 0,ColorMode:void 0,ClientColorSettings:void 0,TranslateLanguage:void 0,LocaleName:void 0},this.m_slideResourceOptions={InputProperties:this.m_slideResourceInputProperties,Filters:{EnableClustering:!1}},this.m_slideAccessibilityInputProperties={TranslateLanguage:void 0,LocaleName:void 0},this.m_slideAccessibilityOptions={InputProperties:this.m_slideAccessibilityInputProperties},this.m_presInfoFilters={RenderSlideShowProperties:!0,FilterHiddenSlideInfo:!1,IncludeSections:!1},this.m_presInfoInputProperties={IsHighContrast:!1,ClientColorSettings:""},this.m_presInfoOptions={Filters:this.m_presInfoFilters,InputProperties:this.m_presInfoInputProperties},this.m_errorMap=new Map,this.setErrorMap(),i&&i.perfTimingMonitorEnabled)try{const e=new Set;this.m_presentUrl&&f.ChangeGate.isChangeGateEnabled("PodsProxy.logPFDPerfTiming")&&(e.add(this.m_presentUrl+"/items"),e.add(this.m_presentUrl+"/ping")),e.add("getitems.ashx"),e.add("getmedia.ashx"),e.add("remoteuls.ashx"),e.add("podhandler.ashx"),e.add("remotetelemetry.ashx"),new PerformanceObserver(t=>E.logPerformanceEntries(t,e)).observe({entryTypes:["resource"]})}catch(e){_.sendTraceTag(572379985,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:PerformanceObserver failed with exception "+e)}}async getSlideOrderAsync(){const e=await this.getPresInfoAsync("getSlideOrderAsync"),t=await e.json();return{itemErrorCodeMap:void 0,itemErrorCategoryMap:void 0,itemUsedOutputCacheMap:void 0,responseErrorCode:a.ErrorRESERVEDSuccess,responseErrorCategory:d.ErrorRESERVEDSuccess,responseIsIntentional:!1,slideId:t.SlideOrder}}async getSlideInfosAsync(e){e.RenderOptions&&(this.m_getPresInfoRequest.SlideRanges=[{IDs:e.SlideLocations.map(e=>e.slideId),RenderOptions:e.RenderOptions}]),this.m_getPresInfoRequest.ClientWidth=e.ClientWidth?e.ClientWidth:this.m_getPresInfoRequest.ClientWidth,this.m_getPresInfoRequest.ClientHeight=e.ClientHeight?e.ClientHeight:this.m_getPresInfoRequest.ClientHeight,this.m_getPresInfoRequest.DevicePixelRatio=e.DevicePixelRatio?e.DevicePixelRatio:this.m_getPresInfoRequest.DevicePixelRatio,this.m_getPresInfoRequest.IsHighContrast=e.IsHighContrast?e.IsHighContrast:this.m_getPresInfoRequest.IsHighContrast,this.m_getPresInfoRequest.ClientColorSettings=e.ClientColorSettings?e.ClientColorSettings:this.m_getPresInfoRequest.ClientColorSettings,this.m_getPresInfoRequest.MinClientWidth=e.MinClientWidth?e.MinClientWidth:this.m_getPresInfoRequest.MinClientWidth,this.m_getPresInfoRequest.MinClientHeight=e.MinClientHeight?e.MinClientHeight:this.m_getPresInfoRequest.MinClientHeight,this.m_getPresInfoRequest.MaxClientWidth=e.MaxClientWidth?e.MaxClientWidth:this.m_getPresInfoRequest.MaxClientWidth,this.m_getPresInfoRequest.MaxClientHeight=e.MaxClientHeight?e.MaxClientHeight:this.m_getPresInfoRequest.MaxClientHeight;const t=await this.getPresInfoAsync("getSlideInfosAsync"),r=await t.json();return{itemErrorCodeMap:void 0,itemErrorCategoryMap:void 0,itemUsedOutputCacheMap:void 0,responseErrorCode:a.ErrorRESERVEDSuccess,responseErrorCategory:d.ErrorRESERVEDSuccess,responseIsIntentional:!1,slideInfo:r.Slides}}async getItemsSlideOrderAsync(){this.m_itemsList=new Array,this.m_itemsList.push({Id:c.PresinfoslimSlideOrder,AcceptTypes:[p.JsonType]}),this.m_getItemsRequest.Items=this.m_itemsList;const e=await this.getItemsAsync("getItemsSlideOrderAsync");return await this.createSlideIdResponse(this.parseMultipartResponseAsync(e,{}))}async getItemsPresInfoAsync(e){this.m_presInfoOptions.InputProperties.ClientHeight=e.ClientHeight?e.ClientHeight:this.m_presInfoInputProperties.ClientHeight,this.m_presInfoOptions.InputProperties.ClientWidth=e.ClientWidth?e.ClientWidth:this.m_presInfoInputProperties.ClientWidth,this.m_presInfoOptions.InputProperties.IsHighContrast=e.IsHighContrast?e.IsHighContrast:this.m_presInfoInputProperties.IsHighContrast,this.m_presInfoOptions.InputProperties.ClientColorSettings=e.ClientColorSettings?e.ClientColorSettings:this.m_presInfoInputProperties.ClientColorSettings,this.m_presInfoOptions.Filters.FilterHiddenSlideInfo=void 0!==e.FilterHiddenSlideInfo?e.FilterHiddenSlideInfo:this.m_presInfoFilters.FilterHiddenSlideInfo,this.m_presInfoOptions.Filters.IncludeSections=void 0!==e.IncludeSections?e.IncludeSections:this.m_presInfoFilters.IncludeSections,this.m_itemsList=new Array,this.m_itemsList.push({Id:c.PresInfoMetaData,AcceptTypes:[p.JsonType],Options:JSON.stringify(this.m_presInfoOptions)}),this.m_getItemsRequest.Items=this.m_itemsList,this.m_requestHeaders.set(l.CallerCorrelationId,e.CorrelationId||""),this.m_requestHeaders.set(l.XCorrelationId,e.CorrelationId||"");const t={...e.RequestInfo,...this.m_settings.sessionInfo,CorrelationId:e.CorrelationId};this.m_requestHeaders.set(l.RequestInfo,JSON.stringify(t));const r=this.objectDictionaryToRequestIdString(t);this.m_requestHeaders.set(l.clientRequestIdHeader,r),this.m_requestHeaders.set(l.PriorityHint,e.PriorityHint?e.PriorityHint.toString():""),this.m_requestHeaders.set(l.IsBootRequest,e.IsBootRequest?e.IsBootRequest.toString():"");const s={action:"getItemsPresInfoAsync",correlationId:e.CorrelationId,server:{start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()}};E.logPerf(s);const o=await this.getItemsAsync("getItemsPresInfoAsync");s[l.server].end=E.performanceNowTrimmed(),o&&o.response&&o.response.headers&&(s[l.contentLength]=o.response.headers.get(l.ContentLength)),E.logPerf(s),s[l.parser]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()};const n=this.setTimeoutForParsingResponse(s),i=await this.createPresInfoResponse(this.parseMultipartResponseAsync(o,s));return clearTimeout(n),s[l.parser].end=E.performanceNowTrimmed(),s[l.usedOutputCache]=!!i.usedOutputCache&&"true"===i.usedOutputCache.trim().toLowerCase(),s[l.itemUsedOutputCacheMap]=!!i.itemUsedOutputCacheMap&&Array.from(i.itemUsedOutputCacheMap.entries()),E.logPerf(s),i.metadata=this.generateReportPerfDictionary(s),i}async getItemsPresInfoAndSlideInfosAsync(e,t,r){const n={action:"getItemsPresInfoAndSlideInfoAsync"};let i=null;try{this.m_presInfoOptions.InputProperties.ClientHeight=e.ClientHeight?e.ClientHeight:this.m_presInfoInputProperties.ClientHeight,this.m_presInfoOptions.InputProperties.ClientWidth=e.ClientWidth?e.ClientWidth:this.m_presInfoInputProperties.ClientWidth,this.m_presInfoOptions.InputProperties.IsHighContrast=e.IsHighContrast?e.IsHighContrast:this.m_presInfoInputProperties.IsHighContrast,this.m_presInfoOptions.InputProperties.ClientColorSettings=e.ClientColorSettings?e.ClientColorSettings:this.m_presInfoInputProperties.ClientColorSettings,this.m_presInfoOptions.Filters.FilterHiddenSlideInfo=void 0!==e.FilterHiddenSlideInfo?e.FilterHiddenSlideInfo:this.m_presInfoFilters.FilterHiddenSlideInfo,this.m_presInfoOptions.Filters.IncludeSections=void 0!==e.IncludeSections?e.IncludeSections:this.m_presInfoFilters.IncludeSections,this.m_itemsList=new Array,this.m_itemsList.push({Id:c.PresInfoMetaData,AcceptTypes:[p.JsonType],Options:JSON.stringify(this.m_presInfoOptions)}),this.m_imageOptions.InputProperties.ClientWidth=t.ClientWidth?t.ClientWidth:this.m_imageInputProperties.ClientWidth,this.m_imageOptions.InputProperties.ClientHeight=t.ClientHeight?t.ClientHeight:this.m_imageInputProperties.ClientHeight,this.m_imageOptions.InputProperties.IsHighContrast=t.IsHighContrast?t.IsHighContrast:this.m_imageInputProperties.IsHighContrast,this.m_imageOptions.InputProperties.ClientColorSettings=t.ClientColorSettings?t.ClientColorSettings:this.m_imageInputProperties.ClientColorSettings,this.m_imageOptions.InputProperties.MinClientWidth=t.MinClientWidth?t.MinClientWidth:this.m_imageInputProperties.MinClientWidth,this.m_imageOptions.InputProperties.MinClientHeight=t.MinClientHeight?t.MinClientHeight:this.m_imageInputProperties.MinClientHeight,this.m_imageOptions.InputProperties.MaxClientWidth=t.MaxClientWidth?t.MaxClientWidth:this.m_imageInputProperties.MaxClientWidth,this.m_imageOptions.InputProperties.MaxClientHeight=t.MaxClientHeight?t.MaxClientHeight:this.m_imageInputProperties.MaxClientHeight,this.m_imageOptions.InputProperties.TranslateLanguage=null!=t.TranslateLanguage?t.TranslateLanguage:this.m_imageInputProperties.TranslateLanguage;for(let e=0;e<t.SlideLocations.length;e+=1)t.GetSlideImage?this.m_itemsList.push({Id:t.SlideLocations[e].slideId?c.slideInfoSid+t.SlideLocations[e].slideId.sid.toString():c.slideInfoIndex+t.SlideLocations[e].slideIndex.toString(),AcceptTypes:E.s_supportedImageType,Options:JSON.stringify(this.m_imageOptions)}):t.Filters&&(this.m_slideInfoOptions.InputProperties={ClientWidth:t.ClientWidth?t.ClientWidth:this.m_slideInfoInputProperties.ClientWidth,ClientHeight:t.ClientHeight?t.ClientHeight:this.m_slideInfoInputProperties.ClientHeight,IsHighContrast:t.IsHighContrast?t.IsHighContrast:this.m_slideInfoInputProperties.IsHighContrast,ColorMode:t.ColorMode?t.ColorMode:this.m_slideInfoInputProperties.ColorMode,ClientColorSettings:t.ClientColorSettings?t.ClientColorSettings:this.m_slideInfoInputProperties.ClientColorSettings,TranslateLanguage:null!=t.TranslateLanguage?t.TranslateLanguage:this.m_slideInfoInputProperties.TranslateLanguage,LocaleName:t.LocaleName?t.LocaleName:this.m_slideInfoInputProperties.LocaleName},this.m_slideInfoOptions.Filters=E.ensureISlideInfoFilters(t.Filters),this.m_itemsList.push({Id:t.SlideLocations[e].slideId?c.slideInfoSid+t.SlideLocations[e].slideId.sid.toString():c.slideInfoIndex+t.SlideLocations[e].slideIndex.toString(),AcceptTypes:[p.JsonType],Options:JSON.stringify(this.m_slideInfoOptions)})),this.m_slideAccessibilityOptions.InputProperties={TranslateLanguage:null!=t.TranslateLanguage?t.TranslateLanguage:this.m_slideAccessibilityInputProperties.TranslateLanguage,LocaleName:t.LocaleName?t.LocaleName:this.m_slideInfoInputProperties.LocaleName},void 0!==t.GetSlideAccessibilityModelData&&t.GetSlideAccessibilityModelData&&this.m_itemsList.push({Id:t.SlideLocations[e].slideId?c.slideAccessibilityModelSid+t.SlideLocations[e].slideId.sid.toString():c.slideAccessibilityModelIndex+t.SlideLocations[e].slideIndex.toString(),AcceptTypes:[p.JsonType],Options:JSON.stringify(this.m_slideAccessibilityOptions)}),t.GetSlideNotes&&this.m_itemsList.push({Id:t.SlideLocations[e].slideId?c.slideNotesSid+t.SlideLocations[e].slideId.sid.toString():c.slideCommentsIndex+t.SlideLocations[e].slideIndex.toString(),AcceptTypes:[p.PlainTextType],Options:JSON.stringify(this.m_slideInfoOptions)}),t.GetSlideComments&&this.m_itemsList.push({Id:t.SlideLocations[e].slideId?c.slideCommentsSid+t.SlideLocations[e].slideId.sid.toString():c.slideCommentsIndex+t.SlideLocations[e].slideIndex.toString(),AcceptTypes:[p.JsonType],Options:t.CommentOptions});this.m_getItemsRequest.Items=this.m_itemsList,this.m_requestHeaders.set(l.CallerCorrelationId,e.CorrelationId||""),this.m_requestHeaders.set(l.XCorrelationId,e.CorrelationId||"");const u={...e.RequestInfo,...this.m_settings.sessionInfo,CorrelationId:e.CorrelationId};this.m_requestHeaders.set(l.RequestInfo,JSON.stringify(u));const m=this.objectDictionaryToRequestIdString(u);this.m_requestHeaders.set(l.clientRequestIdHeader,m),this.m_requestHeaders.set(l.PriorityHint,e.PriorityHint?e.PriorityHint.toString():""),this.m_requestHeaders.set(l.IsBootRequest,e.IsBootRequest?e.IsBootRequest.toString():""),n.correlationId=e.CorrelationId,n[l.server]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()},E.logPerf(n),this.events.emit("requestStageChanged",{requestType:s.getItemsPresInfoAndSlideInfoAsync,stageInfo:o.GetItemsCall});const h=await this.getItemsAsync("getItemsPresInfoAndSlideInfoAsync",{overrideGetItemsTimeoutMs:r&&r.overrideGetItemsTimeoutMs});if(this.m_settings.shouldUpdateNewFileUrlFromSnap&&h.errorCode===a.ServerErrorFileDownloadResourceInconsistent)return{presInfo:void 0,slideInfo:[],responseErrorCode:a.ServerErrorFileDownloadResourceInconsistent,responseErrorCategory:h.errorCategory,responseIsIntentional:h.isIntentional,itemErrorCodeMap:void 0};if(n[l.server].end=E.performanceNowTrimmed(),h&&h.response&&h.response.headers){n[l.contentLength]=h.response.headers.get(l.ContentLength),n[l.ContenEncoding]=h.response.headers.get(l.ContenEncoding),n[l.TransferEncoding]=h.response.headers.get(l.TransferEncoding);const e=h.response.headers.keys();if(e){const t=[];for(const r of e)t.push(r);n[l.ResponseHeaders]=t}}E.logPerf(n),n[l.parser]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()},i=this.setTimeoutForParsingResponse(n);const f=await this.parseMultipartResponseAsync(h,n,{shouldTimeoutResponseStreamDownload:r&&r.shouldTimeoutResponseStreamDownload,overrideDownloadTimeoutMs:r&&r.overrideDownloadTimeoutMs,requestType:s.getItemsPresInfoAndSlideInfoAsync});if(f&&f.responseErrorCode===a.ErrorDownloadResponseStreamTimeout)return{presInfo:void 0,slideInfo:[],responseErrorCode:a.ErrorDownloadResponseStreamTimeout,responseErrorCategory:d.Transient,responseIsIntentional:!1,itemErrorCodeMap:void 0};const g=this.createPresInfoAndSlideInfoResponse(f,n);return null!==i&&(clearTimeout(i),i=null),n[l.parser].end=E.performanceNowTrimmed(),n[l.usedOutputCache]=!!g.usedOutputCache&&"true"===g.usedOutputCache.trim().toLowerCase(),n[l.itemUsedOutputCacheMap]=!!g.itemUsedOutputCacheMap&&Array.from(g.itemUsedOutputCacheMap.entries()),n[l.podsProxyCallSuceeded]=!0,E.logPerf(n),g.metadata=this.generateReportPerfDictionary(n),g}catch(e){return _.sendTraceTag(571548234,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:getItemsPresInfoAndSlideInfosAsync - exception happened: "+e),n[l.podsProxyCallSuceeded]=!1,E.logPerf(n),null!==i&&(clearTimeout(i),i=null),{presInfo:void 0,slideInfo:[],responseErrorCode:a.ErrorRESERVEDItemFailed,responseErrorCategory:d.Transient,responseIsIntentional:!1,itemErrorCodeMap:void 0}}}async getItemsSlideInfosAsync(e){const t={action:"getItemsSlideInfosAsync"};try{this.m_imageOptions.InputProperties.ClientWidth=e.ClientWidth?e.ClientWidth:this.m_imageInputProperties.ClientWidth,this.m_imageOptions.InputProperties.ClientHeight=e.ClientHeight?e.ClientHeight:this.m_imageInputProperties.ClientHeight,this.m_imageOptions.InputProperties.IsHighContrast=null!=e.IsHighContrast?e.IsHighContrast:this.m_imageInputProperties.IsHighContrast,this.m_imageOptions.InputProperties.ColorMode=null!=e.ColorMode?e.ColorMode:this.m_imageInputProperties.ColorMode,this.m_imageOptions.InputProperties.ClientColorSettings=null!=e.ClientColorSettings?e.ClientColorSettings:this.m_imageInputProperties.ClientColorSettings,this.m_imageOptions.InputProperties.MinClientWidth=e.MinClientWidth?e.MinClientWidth:this.m_imageInputProperties.MinClientWidth,this.m_imageOptions.InputProperties.MinClientHeight=e.MinClientHeight?e.MinClientHeight:this.m_imageInputProperties.MinClientHeight,this.m_imageOptions.InputProperties.MaxClientWidth=e.MaxClientWidth?e.MaxClientWidth:this.m_imageInputProperties.MaxClientWidth,this.m_imageOptions.InputProperties.MaxClientHeight=e.MaxClientHeight?e.MaxClientHeight:this.m_imageInputProperties.MaxClientHeight,this.m_imageOptions.InputProperties.TranslateLanguage=null!=e.TranslateLanguage?e.TranslateLanguage:this.m_imageInputProperties.TranslateLanguage,this.m_itemsList=new Array;for(let t=0;t<e.SlideLocations.length;t+=1)e.GetSlideImage?this.m_itemsList.push({Id:e.SlideLocations[t].slideId?c.slideInfoSid+e.SlideLocations[t].slideId.sid.toString():c.slideInfoIndex+e.SlideLocations[t].slideIndex.toString(),AcceptTypes:E.s_supportedImageType,Options:JSON.stringify(this.m_imageOptions)}):e.Filters&&(this.m_slideInfoOptions.InputProperties={ClientWidth:e.ClientWidth?e.ClientWidth:this.m_slideInfoInputProperties.ClientWidth,ClientHeight:e.ClientHeight?e.ClientHeight:this.m_slideInfoInputProperties.ClientHeight,IsHighContrast:e.IsHighContrast?e.IsHighContrast:this.m_slideInfoInputProperties.IsHighContrast,ColorMode:e.ColorMode?e.ColorMode:this.m_slideInfoInputProperties.ColorMode,ClientColorSettings:e.ClientColorSettings?e.ClientColorSettings:this.m_slideInfoInputProperties.ClientColorSettings,TranslateLanguage:null!=e.TranslateLanguage?e.TranslateLanguage:this.m_slideInfoInputProperties.TranslateLanguage,LocaleName:null!=e.LocaleName?e.LocaleName:this.m_slideInfoInputProperties.LocaleName},this.m_slideInfoOptions.Filters=E.ensureISlideInfoFilters(e.Filters),e.SkipGetSlideInfo||this.m_itemsList.push({Id:e.SlideLocations[t].slideId?c.slideInfoSid+e.SlideLocations[t].slideId.sid.toString():c.slideInfoIndex+e.SlideLocations[t].slideIndex.toString(),AcceptTypes:[p.JsonType],Options:JSON.stringify(this.m_slideInfoOptions)})),this.m_slideAccessibilityOptions.InputProperties={TranslateLanguage:null!=e.TranslateLanguage?e.TranslateLanguage:this.m_slideAccessibilityInputProperties.TranslateLanguage,LocaleName:e.LocaleName?e.LocaleName:this.m_slideInfoInputProperties.LocaleName},void 0!==e.GetSlideAccessibilityModelData&&e.GetSlideAccessibilityModelData&&this.m_itemsList.push({Id:e.SlideLocations[t].slideId?c.slideAccessibilityModelSid+e.SlideLocations[t].slideId.sid.toString():c.slideAccessibilityModelIndex+e.SlideLocations[t].slideIndex.toString(),AcceptTypes:[p.JsonType],Options:JSON.stringify(this.m_slideAccessibilityOptions)}),e.GetSlideNotes&&this.m_itemsList.push({Id:e.SlideLocations[t].slideId?c.slideNotesSid+e.SlideLocations[t].slideId.sid.toString():c.slideCommentsIndex+e.SlideLocations[t].slideIndex.toString(),AcceptTypes:[p.PlainTextType],Options:JSON.stringify(this.m_slideInfoOptions)}),e.GetSlideComments&&this.m_itemsList.push({Id:e.SlideLocations[t].slideId?c.slideCommentsSid+e.SlideLocations[t].slideId.sid.toString():c.slideCommentsIndex+e.SlideLocations[t].slideIndex.toString(),AcceptTypes:[p.JsonType],Options:e.CommentOptions});if(0===this.m_itemsList.length)return _.sendTraceTag(595076497,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:getItemsSlideInfosAsync - invalid request item list"),{itemErrorCodeMap:void 0,itemErrorCategoryMap:void 0,itemUsedOutputCacheMap:void 0,responseErrorCode:a.ErrorRequestFailed,responseErrorCategory:d.BadRequest,responseIsIntentional:!1,slideInfo:[]};this.m_getItemsRequest.Items=this.m_itemsList,this.m_requestHeaders.set(l.CallerCorrelationId,e.CorrelationId||""),this.m_requestHeaders.set(l.XCorrelationId,e.CorrelationId||"");const t={...e.RequestInfo,...this.m_settings.sessionInfo,CorrelationId:e.CorrelationId};this.m_requestHeaders.set(l.RequestInfo,JSON.stringify(t));const r=this.objectDictionaryToRequestIdString(t);this.m_requestHeaders.set(l.clientRequestIdHeader,r),this.m_requestHeaders.set(l.PriorityHint,e.PriorityHint?e.PriorityHint.toString():""),this.m_requestHeaders.set(l.IsBootRequest,e.IsBootRequest?e.IsBootRequest.toString():"");const s={action:"getItemsSlideInfosAsync",correlationId:e.CorrelationId,server:{start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()}};s.correlationId=e.CorrelationId,s[l.server]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()},E.logPerf(s);const o=await this.getItemsAsync("getItemsSlideInfosAsync");if(this.m_settings.shouldUpdateNewFileUrlFromSnap&&o.errorCode===a.ServerErrorFileDownloadResourceInconsistent)return{slideInfo:[],responseErrorCode:a.ServerErrorFileDownloadResourceInconsistent,responseErrorCategory:o.errorCategory,responseIsIntentional:!!o.headers.get(l.IsIntentional)&&o.headers.get(l.IsIntentional),itemErrorCodeMap:void 0};s[l.server].end=E.performanceNowTrimmed(),o&&o.response&&o.response.headers&&(s[l.contentLength]=o.response.headers.get(l.ContentLength)),s[l.parser]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()},E.logPerf(s);const n=this.setTimeoutForParsingResponse(s),i=await this.createSlideInfoResponse(this.parseMultipartResponseAsync(o,s),s);return clearTimeout(n),s[l.parser].end=E.performanceNowTrimmed(),s[l.usedOutputCache]=!!i.usedOutputCache&&"true"===i.usedOutputCache.trim().toLowerCase(),s[l.itemUsedOutputCacheMap]=!!i.itemUsedOutputCacheMap&&Array.from(i.itemUsedOutputCacheMap.entries()),s[l.podsProxyCallSuceeded]=!0,E.logPerf(s),i.metadata=this.generateReportPerfDictionary(s),i}catch(e){return _.sendTraceTag(570950493,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:getItemsSlideInfosAsync - exception happened: "+e),t[l.podsProxyCallSuceeded]=!1,E.logPerf(t),{slideInfo:[],responseErrorCode:a.ErrorRESERVEDItemFailed,responseErrorCategory:d.Transient,responseIsIntentional:!1,itemErrorCodeMap:void 0,itemErrorCategoryMap:void 0,itemUsedOutputCacheMap:void 0}}}async getItemsResourceAsync(e){this.m_slideResourceOptions.InputProperties={ClientWidth:e.ClientWidth?e.ClientWidth:this.m_slideResourceInputProperties.ClientWidth,ClientHeight:e.ClientHeight?e.ClientHeight:this.m_slideResourceInputProperties.ClientHeight,IsHighContrast:e.IsHighContrast?e.IsHighContrast:this.m_slideResourceInputProperties.IsHighContrast,ColorMode:e.ColorMode?e.ColorMode:this.m_slideResourceInputProperties.ColorMode,ClientColorSettings:e.ClientColorSettings?e.ClientColorSettings:this.m_slideResourceInputProperties.ClientColorSettings,TranslateLanguage:null!=e.TranslateLanguage?e.TranslateLanguage:this.m_slideResourceInputProperties.TranslateLanguage,LocaleName:null!=e.LocaleName?e.LocaleName:this.m_slideResourceInputProperties.LocaleName},this.m_slideResourceOptions.Filters.EnableClustering=void 0!==e.EnableClustering&&e.EnableClustering,this.m_itemsList=new Array;for(const t of e.ResourceParams){this.m_slideResourceOptions.InputProperties.ResourceId=t.Id;let e="";switch(String(t.Name.match("[^.]+$"))){case"jpg":e=p.ImageJpg;break;case"png":e=p.ImagePng}this.m_itemsList.push({Id:t.Name,AcceptTypes:e?[e]:E.s_supportedImageType,Options:JSON.stringify(this.m_slideResourceOptions)})}this.m_getItemsRequest.Items=this.m_itemsList,this.m_requestHeaders.set(l.CallerCorrelationId,e.CorrelationId||""),this.m_requestHeaders.set(l.XCorrelationId,e.CorrelationId||""),this.m_requestHeaders.set(l.IsBootRequest,e.IsBootRequest?e.IsBootRequest.toString():"");const t={action:"getItemsResourceAsync",correlationId:e.CorrelationId,server:{start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()}};E.logPerf(t);const r=await this.getItemsAsync("getItemsResourceAsync");t[l.server].end=E.performanceNowTrimmed(),r&&r.response&&r.response.headers&&(t[l.contentLength]=r.response.headers.get(l.ContentLength)),t[l.parser]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()},E.logPerf(t);const s=this.setTimeoutForParsingResponse(t),o=await this.createSlideInfoResponse(this.parseMultipartResponseAsync(r,t),t);return clearTimeout(s),t[l.parser].end=E.performanceNowTrimmed(),t[l.usedOutputCache]=!!o.usedOutputCache&&"true"===o.usedOutputCache.trim().toLowerCase(),t[l.itemUsedOutputCacheMap]=!!o.itemUsedOutputCacheMap&&Array.from(o.itemUsedOutputCacheMap.entries()),E.logPerf(t),o.metadata=this.generateReportPerfDictionary(t),o}async getItemsSlideOrderAndSlidesInfoIndexAsync(e,t,r){this.m_getItemsRequest.Items.push({Id:c.PresinfoslimSlideOrder,AcceptTypes:[p.JsonType],Options:JSON.stringify(r)});const s=JSON.stringify(t);e&&e.forEach(e=>{this.m_getItemsRequest.Items.push({Id:`${c.slideInfoIndex}${e}`,AcceptTypes:[p.ImagePng,p.ImageJpg],Options:s})});const o={action:"getItemsSlideOrderAndSlidesInfoIndexAsync",server:{start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()}};E.logPerf(o);const n=await this.getItemsAsync("getItemsSlideOrderAndSlidesInfoIndexAsync");o[l.server].end=E.performanceNowTrimmed(),o[l.parser]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()},n&&n.response&&n.response.headers&&(o[l.contentLength]=n.response.headers.get(l.ContentLength)),E.logPerf(o);const i=this.setTimeoutForParsingResponse(o),a=await this.createSlideOrderAndSlidesInfoIndexResponse(this.parseMultipartResponseAsync(n,o));return clearTimeout(i),o[l.parser].end=E.performanceNowTrimmed(),o[l.usedOutputCache]=!!a.usedOutputCache&&"true"===a.usedOutputCache.trim().toLowerCase(),o[l.itemUsedOutputCacheMap]=!!a.itemUsedOutputCacheMap&&Array.from(a.itemUsedOutputCacheMap.entries()),E.logPerf(o),a.metadata=this.generateReportPerfDictionary(o),a}async getPresInfoAsync(e){_.sendTraceTag(593896001,m.msoulscat_Wac_PptSession,h.Info,`PodsProxy::getPresInfoAsync - Function:${e}, requestCorrelation:${this.m_requestHeaders.get(l.CallerCorrelationId)}`);const t=new AbortController,r=setTimeout(()=>t.abort(),3e4),s=await fetch(this.m_podsUrl+"/presinfo.ashx",{headers:this.m_requestHeaders,method:"POST",body:JSON.stringify(this.m_getPresInfoRequest),signal:t.signal}).catch(async t=>{throw _.sendTraceTag(595686995,m.msoulscat_Wac_PptSession,h.Error,`PodsProxy:getPresInfo - Function: ${e}, Error: ${t}`),t});return clearTimeout(r),_.sendTraceTag(595686996,m.msoulscat_Wac_PptSession,s.ok?h.Info:h.Error,`PodsProxy::getPresInfo - Function: ${e}, Status:${s.status}, StatusText: ${s.statusText}, CorrelationId: ${s.headers.get(l.XCorrelationId)}`),s}static getFieldFromReponseHeader(e,t){return e.headers?e.headers.get(t):l.unknown}async getItemsAsync(e,t){const r=this.m_requestHeaders.get(l.CallerCorrelationId);_.sendTraceTag(593896002,m.msoulscat_Wac_PptSession,h.Info,`PodsProxy::getItemsAsync - Function:${e}, requestCorrelation:${r}`);const s={errorCode:a.ErrorRESERVEDSuccess};let o=s,n="getItemsPresInfoAndSlideInfoAsync"===e&&this.m_settings.shouldUseBootRequestTimeout&&this.m_settings.bootRequestTimeout?this.m_settings.bootRequestTimeout:this.m_settings.timeout;t&&t.overrideGetItemsTimeoutMs&&(n=t.overrideGetItemsTimeoutMs),this.m_requestHeaders.set(l.dateHeader,(new Date).toISOString()),this.m_requestHeaders.set(l.clientTimeoutHeader,n.toString()),this.m_requestHeaders.set(l.callId,this.m_settings.callId||"empty");let i=this.m_podsUrl+"/getitems.ashx";(this.m_settings.pptoPresentFrontDoorEnabled||C.Settings.readBooleanOrDefault("enableUsePresentFrontdoor",!1))&&(this.m_presentUrl?i=this.m_presentUrl+"/items":_.sendTraceTag(508638343,m.msoulscat_Wac_PptSession,h.Warning,"PodsProxy::getItemsAsync enableUsePresentFrontdoor is true but presentUrl is null. Using podsUrl. }"));const c=this.m_getItemsRequest.Items.map(e=>e.Id);E.s_events.emit("networkCall",{url:i,itemIds:c});const p=new AbortController,u=setTimeout(()=>p.abort(),n);o=await fetch(i,{headers:this.m_requestHeaders,method:"POST",body:JSON.stringify(this.m_getItemsRequest),signal:p.signal}).catch(async t=>{const o=t.response&&t.response.headers?t.response.headers.get(l.XCorrelationId):l.unknown,n=t.response&&t.response.headers?t.response.headers.get(l.ErrorCode):l.unknown,i=t.response&&t.response.headers?t.response.headers.get(l.ErrorCategory):l.unknown,c=!(!t.response||!t.response.headers)&&t.response.headers.get(l.IsIntentional),p=t.response&&t.response.status?t.response.status:l.unknown;let u=t.toString();u.length>0&&("."===u.slice(-1)||"。"===u.slice(-1))&&(u=u.slice(0,-1));const f=this.getMappedError(u);return f?s.errorCode=f:"HTTPError"===t.name&&p!==l.unknown&&500!==p&&this.m_errorMap.has(p)?s.errorCode=this.m_errorMap.get(p):"TimeoutError"===t.name?s.errorCode=a.ErrorRequestTimeout:s.errorCode=E.convertServerError(n,this.m_settings.enableServerSpecificErrorCode),this.m_settings.shouldUpdateNewFileUrlFromSnap&&s.errorCode===a.ServerErrorFileDownloadResourceInconsistent&&(s.newSnapUrl=E.getFieldFromReponseHeader(t.response,l.newSnapUrlHeader)),s.errorCategory=i&&""!==i.trim()&&i!==l.unknown?i:d.Transient,s.isIntentional=c!==l.unknown&&c,_.sendTraceTag(595687001,m.msoulscat_Wac_PptSession,h.Error,`PodsProxy:getItems - Function:${e}, Error:${t}, ErrorName:${t.name}, Status:${t.status}, HeaderCorrelationId:${o}, HeaderErrorCode:${n}, HeaderErrorCategory:${i}, result.isIntentional:${s.isIntentional}, result.errorCode:${s.errorCode}, requestCorrelation:${r}, status:${p}`),s}),clearTimeout(u),s.response=o;try{if(this.m_settings.shouldUpdateNewFileUrlFromSnap&&(s.errorCode===a.ServerErrorFileDownloadResourceInconsistent||s.newSnapUrl)){if(_.sendTraceTag(541403227,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy:getItems trigger shouldUpdateNewFileUrlFromSnap flow"),s.newSnapUrl)return s.errorCode===a.ErrorRESERVEDSuccess&&_.sendTraceTag(509875216,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:got new snap url without errorcode"),_.sendTraceTag(541403228,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy:getItems get valid new file url"),this.events.emit("downloadUrlChanged",s.newSnapUrl),s;_.sendTraceTag(541345432,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:getItems no valid new file url in ServerErrorFileDownloadResourceInconsistent response")}}catch(e){_.sendTraceTag(541403229,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:getItems exception trying to check ServerErrorFileDownloadResourceInconsistent")}200!==o.status&&s.errorCode===a.ErrorRESERVEDSuccess&&(o.headers&&o.headers.get(l.ErrorCode)?(s[l.errorCode]=E.convertServerError(o.headers.get(l.ErrorCode),this.m_settings.enableServerSpecificErrorCode),s[l.errorCategory]=o.headers.get(l.ErrorCategory)?o.headers.get(l.ErrorCategory):d.BadRequest,s[l.IsIntentional]=!!o.headers.get(l.IsIntentional)&&o.headers.get(l.IsIntentional)):(o.status!==l.unknown&&this.m_errorMap.has(o.status)?s[l.errorCode]=this.m_errorMap.get(o.status):s[l.errorCode]=a.ErrorRequestFailed,s[l.errorCategory]=d.Transient,s[l.IsIntentional]=!1));const f={functionName:e,status:o.status,statusText:o.statusText,headerCorrelation:o.headers?o.headers.get(l.XCorrelationId):"",headerErrorCode:o.headers?o.headers.get(l.ErrorCode):"",headerErrorCategory:o.headers?o.headers.get(l.ErrorCategory):"",headerErrorIntentional:!!o.headers&&o.headers.get(l.IsIntentional),requestCorrelation:r,resultErrorCode:s.errorCode,resultErrorCategory:s.errorCategory,resultIsIntentional:s.IsIntentional};return _.sendTraceTag(595687002,m.msoulscat_Wac_PptSession,o.ok?h.Info:h.Error,JSON.stringify(f)),s}async getSessionUtcAsync(){let e=-1;const t=new AbortController,r=setTimeout(()=>t.abort(),2500),s=await fetch(this.m_podsUrl+"/podhandler.ashx?action=GetSessionUTC&format=jsms",{headers:new Headers,method:"GET",signal:t.signal}).catch(async e=>{_.sendTraceTag(587831243,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:getSessionUtcAsync - Error: "+e)});clearTimeout(r);try{s?(e=parseInt(await s.text(),10),_.sendTraceTag(587831244,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy::getSessionUtcAsync: "+e)):_.sendTraceTag(572613792,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:getSessionUtcAsync - Null response.")}catch(e){_.sendTraceTag(587831245,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy::getSessionUtcAsync - error parsing response. "+e)}return e}updateDocSource(e){_.sendTraceTag(573855198,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy - call updateDocSource."),this.m_getPresInfoRequest?this.m_getPresInfoRequest.Source=e:_.sendTraceTag(573855199,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy::updateDocSource - no valid m_getPresInfoRequest to update."),this.m_getItemsRequest?this.m_getItemsRequest.Source=e:_.sendTraceTag(573855200,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy::updateDocSource - no valid m_getItemsRequest to update.")}async generateSnapDownloadUrlAsync(e,t){try{_.sendTraceTag(573875969,m.msoulscat_Wac_PptSession,h.Info,`PodsProxy::generateSnapDownloadUrlAsync - snapDownloadUrlRequest.ID: ${e.ID}.`);const r=new Headers;r.append(l.ContentType,"application/json; charset=utf-8"),r.append(l.CallerCorrelationId,e.ID),t&&t.forEach((e,t)=>{r.append(t,e)});const s=this.m_podsUrl+"/SnapUrlHandler.ashx",o=new AbortController,n=setTimeout(()=>o.abort(),this.m_settings.timeout),i=await fetch(s,{headers:r,method:"POST",body:JSON.stringify(e),signal:o.signal}).catch(async e=>{_.sendTraceTag(573875971,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:generateSnapDownloadUrlAsync - error when calling SnapUrlHandler : "+e)});clearTimeout(n);let a="";if(i){const e=await i.json();_.sendTraceTag(573875972,m.msoulscat_Wac_PptSession,h.Info,`PodsProxy:generateSnapDownloadUrlAsync - snapUrlResponse, FSuccess:${e.FSuccess}, ErrorCode:${e.ErrorCode}`),e.FSuccess?a=e.SnapUrl:_.sendTraceTag(573875973,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:generateSnapDownloadUrlAsync - snap url failed with errorCode : "+e.ErrorCode)}return a}catch(e){return _.sendTraceTag(573875974,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:generateSnapDownloadUrlAsync - exception: "+e),""}}setErrorMap(){const e=["cancelled","cancelado","キャンセルしました","Abgebrochen","취소됨","已取消","annulé","مُلغى","avbruten","отменено","annullato","zrušeno","poništeno","geannuleerd","ถูกยกเลิก","avbrutt","annulleret","скасовано","בוטל","đã huỷ","Kumottu","dibatalkan","vazgeçildi","anulat","anulowane","ακυρώθηκε","visszavonva"];for(let t=0;t<e.length;t+=1)this.m_errorMap.set(e[t],a.ErrorRequestCanceled);const t=["The network connection was lost","Could not connect to the server","connection was lost","The internet connection appears to be offline","La conexión de red se perdió","ネットワーク接続が切れました","La connexion réseau a été perdue","Сетевое соединение потеряно","網路連線中斷","การเชื่อมต่อกับเครือข่ายหายไป","Зʼєднання з мережею втрачено","网络连接已中断","Nätverksanslutningen förlorades","A conexão de rede foi perdida","Ağ bağlantısı kesildi","Die Netzwerkverbindung wurde unterbrochen","La connessione è stata persa","A ligação à rede foi interrompida","Mistet nettverksforbindelsen","La conexión de red se ha perdido","網絡連線中斷","Đã mất kết nối mạng","Kehilangan jaringan koneksi","تم فقدان اتصال الشبكة","無法連接伺服器","네트워크 연결이 유실되었습니다","Verkkoyhteys katkesi","Netværksforbindelsen gik tabt","Bylo ztraceno připojení k síti","Połączenie sieciowe zostało utracone","A conexão à internet parece estar desativada","The Internet connection appears to be offline","La conexión a Internet parece estar desactivada","Could not connect to the server","De netwerkverbinding is verbroken","Conexiunea de rețea a fost pierdută","ネットワーク接続が切れました","החיבור לרשת אבד","NetworkError when attempting to fetch resource","无法连接服务器","No se ha podido establecer conexión con el servidor","Tidak dapat terhubung ke server","ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์ได้","No se pudo establecer conexión con el servidor","A hálózati kapcsolat megszakadt"];for(let e=0;e<t.length;e+=1)this.m_errorMap.set(t[e],a.ErrorConnectionLost);const r=["Impossibile completare l'operazione. Il software ha provocato l'interruzione della connessione","No se pudo completar la operación. El software causó la anulación de la conexión","Không thể hoàn tất tác vụ. Phần mềm đã khiến kết nối bị hủy bỏ","تعذر إكمال العملية. ‏نتج عن البرنامج إيقاف الاتصال قبل اكتماله","Не удалось завершить операцию. Программа вызвала разрыв подключения","The operation couldn’t be completed. Software caused connection abort","Toimintoa ei voitu suorittaa. Ohjelmistosta johtuva yhteyden keskeytys","L’opération n’a pas pu s’achever. Interruption de la connexion due au logiciel","Operasi tidak dapat diselesaikan. Perangkat lunak menyebabkan pemutusan koneksi","No se pudo completar la operación. El software causó la anulación de la conexión","A operação não pôde ser concluída. O software provocou o cancelamento da conexão","No se ha podido completar la operación. El software ha causado la anulación de la conexión","Impossibile completare l'operazione. Il software ha provocato l'interruzione della connessione","Der Vorgang konnte nicht abgeschlossen werden. Die Software hat einen Verbindungsabbruch verursacht","未能完成该操作。软件导致连接中止","無法完成作業。軟體導致連線失敗","無法完成操作。軟件導致連線失敗","ไม่สามารถดำเนินการให้เสร็จสิ้นได้ ซอฟต์แวร์เป็นสาเหตุให้ยกเลิกการเชื่อมต่อ","操作を完了できませんでした。ソフトウェアにより接続が中止されました","Postupak se nije mogao dovršiti. Softver je uzrokovao prekid veze","Åtgärden kunde inte slutföras. Program orsakade avbrott i anslutningen","İşlem tamamlanamadı. Yazılım bağlantının kesilmesine neden oldu","Не вдалося завершити операцію. Програма обірвала звʼязок"];for(let e=0;e<r.length;e+=1)this.m_errorMap.set(r[e],a.ErrorSoftwareConnectionAbort);const s=["The request timed out","要求がタイムアウトになりました","La requête a expiré","要求がタイムアウトになりました","Se agotó el tiempo de espera","Esgotou-se o tempo limite da solicitação","请求超时"];for(let e=0;e<s.length;e+=1)this.m_errorMap.set(s[e],a.ErrorRequestTimeout);const o=["cannot parse response","impossible d’analyser la réponse","无法解析响应"];for(let e=0;e<o.length;e+=1)this.m_errorMap.set(o[e],a.ErrorCannotParseResponse);this.m_errorMap.set("The operation was aborted",a.ErrorRequestAbort),this.m_errorMap.set("Failed to fetch",a.ErrorFailedToFetch),this.m_errorMap.set(404,a.ErrorRequestFailedServerNotFound),this.m_errorMap.set(502,a.ErrorRequestFailedBadGateway),this.m_errorMap.set(503,a.ErrorRequestFailedServiceUnavailable),this.m_errorMap.set(504,a.ErrorRequestFailedGatewayTimeout)}getMappedError(e){let t=e;return t=E.trimErrorName(t,["TypeError:","Loading failed:"]),t.indexOf("Bylo ztraceno")>=0?a.ErrorConnectionLost:t.indexOf("AbortError:")>=0?a.ErrorRequestAbort:this.m_errorMap.get(t)}static trimErrorName(e,t){let r=e;for(let e=0;e<t.length;e+=1)r.lastIndexOf(t[e])>=0&&(r=r.substring(r.lastIndexOf(t[e])+t[e].length));return r?r.trim():""}static convertServerError(e,t){return t&&e&&""!==e.trim()&&e!==l.unknown?"Server"+e:a.ErrorRequestFailed}async parseMultipartResponseAsync(e,t,r){const n={},i={itemErrorCodeMap:new Map,itemErrorCategoryMap:new Map,itemUsedOutputCacheMap:new Map,responseErrorCode:a.ErrorRESERVEDSuccess,responseErrorCategory:d.ErrorRESERVEDSuccess,responseIsIntentional:!1,data:void 0};let c={slideOrder:[],slideAllInfo:[]};if(t[l.firstResponseCheck]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()},e.response&&e.response.body&&e.response.headers&&e.response.headers.get(l.ContentType)){const p=e.response;let u="";try{t[l.fetchBoundary]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()},u=this.m_multipartParser.fetchBoundary(p.headers.get(l.ContentType)),t[l.fetchBoundary].end=E.performanceNowTrimmed()}catch(t){const r=p.headers.get(l.ErrorCode),s=p.headers.get(l.ErrorCategory),o=!!e[l.IsIntentional]&&e[l.IsIntentional],n=p.headers.get(l.XCorrelationId);return _.sendTraceTag(593253142,m.msoulscat_Wac_PptSession,h.Error,`PodsProxy::parseMultipartResponse - fetchBoundary Content-Type header: ${p.headers.get(l.ContentType)}, ErrorCode:${r}, ErrorCategory:${s}, IsIntentional:${o} , Correlation:${n}, Exception:${t}`),i.responseErrorCode=r||a.ErrorRequestFailed,i.responseErrorCategory=s||d.BadRequest,i}const g=E.performanceNowTrimmed();t[l.downloadResponse]={start:g,end:g},_.sendTraceTag(561640520,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy::parseMultipartResponse - download response stream start: "+g),r&&r.requestType===s.getItemsPresInfoAndSlideInfoAsync&&this.events.emit("requestStageChanged",{requestType:r.requestType,stageInfo:o.DownloadResponseStream});let I,S=!1,P=void 0,T=null;const w=p.headers?p.headers.get(l.ContentLength):-1;let R=-1;if(_.sendTraceTag(545063708,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy:shouldUseResponseStreamWhenReceivedTotalLength: "+this.m_settings.shouldUseResponseStreamWhenReceivedTotalLength),this.m_settings.parsingWhileDownloadingEnabled){let e=!1,I=!1;const P=n=>{e=!0,I=n;const i={receivedDataLength:R,responseContentLength:w,duration:E.performanceNowTrimmed()-g,downloadFailed:I};_.sendTraceTag(529331328,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy - return from response stream reading. "+JSON.stringify(i));const a=E.performanceNowTrimmed();_.sendTraceTag(529331329,m.msoulscat_Wac_PptSession,h.Info,`PodsProxy::parseMultipartResponse - download response stream end: ${a}, duration: ${a-g}`),t[l.downloadResponse].end=a,t[l.downloadResponse].length=R,!S&&r&&r.requestType===s.getItemsPresInfoAndSlideInfoAsync&&this.events.emit("requestStageChanged",{requestType:r.requestType,stageInfo:o.ParseMultipartResponse})};R=0;const T=p.body,[v,O]=T.tee(),M=new Promise(async e=>{try{const t=C.Settings.readNumberOrDefault("hackMaxBytes",-1),r=v.getReader();for(;;){const{done:s,value:o}=await r.read();if(s){P(!1),e();break}if(o&&(R+=o.length,t>0&&R>t))throw"hackMaxBytes hit"}}catch(t){_.sendTraceTag(528766114,m.msoulscat_Wac_PptSession,h.Error,`PodsProxy::measuringDownloadPromise - exception ${t}.`),P(!0),e()}});let b;if(r&&r.shouldTimeoutResponseStreamDownload){const t=r&&r.overrideDownloadTimeoutMs?r.overrideDownloadTimeoutMs:this.m_settings.responseStreamDownloadTimeout?this.m_settings.responseStreamDownloadTimeout:3e4;b=window.setTimeout(()=>{e||(S=!0,_.sendTraceTag(529331330,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy::parseMultipartResponse - download response stream timeout."),_.sendTraceTag(529331331,m.msoulscat_Wac_PptSession,h.Warning,"PodsProxy::parseMultipartResponse - cancel reading current response stream due to timeout"),v.cancel(),O.cancel())},t)}const x=new y(this.m_settings,n,t,i),W=this.m_multipartParser.processMultipartBinaryResponse(O.getReader(),u,e=>{x.parsePart(e)});if(await Promise.all([M,W]),I)return f.ChangeGate.isChangeGateEnabled("retryOnNetworkFailure")&&(i.responseErrorCode=a.ErrorRequestFailed,i.responseErrorCategory=d.Transient),i.data=void 0,i;if(r&&r.shouldTimeoutResponseStreamDownload&&(clearTimeout(b),_.sendTraceTag(529331332,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy - response download check. "+JSON.stringify({hasTimeout:S,shouldUseResponseStreamWhenReceivedTotalLength:this.m_settings.shouldUseResponseStreamWhenReceivedTotalLength,receivedDataLength:R,responseContentLength:w}))),S){if(!(this.m_settings.shouldUseResponseStreamWhenReceivedTotalLength&&w>0&&R>0&&w===R))return i.responseErrorCode=a.ErrorDownloadResponseStreamTimeout,i;_.sendTraceTag(529331333,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy:parseMultipartResponse - try to use already returned response stream when timeout happens")}c=x.parsedResponse}else{if(r&&r.shouldTimeoutResponseStreamDownload){const e=r&&r.overrideDownloadTimeoutMs?r.overrideDownloadTimeoutMs:this.m_settings.responseStreamDownloadTimeout?this.m_settings.responseStreamDownloadTimeout:3e4,t="downloadResponseStreamTimeout";let s;const o=new Promise(r=>{P=setTimeout(()=>{_.sendTraceTag(560347103,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy::parseMultipartResponse - download response stream timeout."),s&&(_.sendTraceTag(558465244,m.msoulscat_Wac_PptSession,h.Warning,"PodsProxy::parseMultipartResponse - cancel reading current response stream due to timeout"),s.cancel()),r(t)},e)});s=p.body.getReader(),T=this.readResponseStream(s,w),T.then(e=>{R=e&&e.length||-1;const t={receivedDataLength:R,responseContentLength:w,duration:E.performanceNowTrimmed()-g};_.sendTraceTag(558465177,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy - return from response stream reading. "+JSON.stringify(t))}),I=await Promise.race([T,o]),I===t?S=!0:void 0!==P&&clearTimeout(P)}else{I=new Uint8Array(await p.arrayBuffer());const e=C.Settings.readNumberOrDefault("hackMaxBytes",-1);e>0&&I.length>e&&(I=I.slice(0,e))}if(r&&r.shouldTimeoutResponseStreamDownload&&_.sendTraceTag(543019648,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy - response download check. "+JSON.stringify({hasTimeout:S,shouldUseResponseStreamWhenReceivedTotalLength:this.m_settings.shouldUseResponseStreamWhenReceivedTotalLength,receivedDataLength:R,responseContentLength:w})),S){if(!(this.m_settings.shouldUseResponseStreamWhenReceivedTotalLength&&T&&w>0&&R>0&&w===R))return i.responseErrorCode=a.ErrorDownloadResponseStreamTimeout,i;_.sendTraceTag(558465245,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy:parseMultipartResponse - try to use already returned response stream when timeout happens"),I=await T}const e=E.performanceNowTrimmed();_.sendTraceTag(561640521,m.msoulscat_Wac_PptSession,h.Info,`PodsProxy::parseMultipartResponse - download response stream end: ${e}, duration: ${e-g}`);const d=I;t[l.downloadResponse].end=e,d&&d.length&&(t[l.downloadResponse].length=d.length),r&&r.requestType===s.getItemsPresInfoAndSlideInfoAsync&&this.events.emit("requestStageChanged",{requestType:r.requestType,stageInfo:o.ParseMultipartResponse});const f=new y(this.m_settings,n,t,i);await this.m_multipartParser.processMultipartBinaryResponse(d,u,e=>{f.parsePart(e)}),c=f.parsedResponse}}else{const t=e.hasOwnProperty(l.errorCode)&&e[l.errorCode]!==a.ErrorRESERVEDSuccess?e[l.errorCode]:a.ErrorRequestFailed,r=e[l.errorCategory]?e[l.errorCategory]:d.BadRequest,s=!!e[l.IsIntentional]&&e[l.IsIntentional];i.responseErrorCode=t,i.responseErrorCategory=r,_.sendTraceTag(593253143,m.msoulscat_Wac_PptSession,h.Error,`PodsProxy::parseMultipartResponse - responseErrorCode:${t}, responseErrorCategory:${r}, IsIntentional:${s}`)}t[l.firstResponseCheck].end=E.performanceNowTrimmed(),i.responseErrorCode!==a.ErrorRESERVEDSuccess&&i.responseErrorCategory===d.ErrorRESERVEDSuccess&&(i.responseErrorCategory=d.BadRequest,_.sendTraceTag(593253145,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy::parseMultipartResponse - parsedResponse contains errorCode but no errorCategory. responseErrorCode:"+i.responseErrorCode));for(const e in n)c.slideAllInfo.push({ID:n[e].ID,SlideImageData:n[e].SlideImageData,SlideShowInfo:n[e].SlideShowInfo,Title:n[e].Title,NoteHtml:n[e].NoteHtml,Comments:n[e].Comments,HasAnimation:n[e].HasAnimation,Hidden:n[e].Hidden,HasTransition:n[e].HasTransition,ResourceData:n[e].ResourceData,AccessibilityModel:n[e].AccessibilityModel,MediaUrls:n[e].MediaUrls});try{if(C.Settings.readBooleanOrDefault("shouldUpdateNewFileUrlFromSnapTrailerItem",!1)&&(i.itemErrorCodeMap&&Object.values(i.itemErrorCodeMap).includes(a.ServerErrorFileDownloadResourceInconsistent)||i.newSnapUrl)){if(i.newSnapUrl)return 0===i.itemErrorCodeMap.size&&_.sendTraceTag(509875215,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:got new snap url without errorcode"),_.sendTraceTag(510251348,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy:getItems get valid new file url"),this.events.emit("downloadUrlChanged",i.newSnapUrl),i;_.sendTraceTag(510251347,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:getItems no valid new file url in ServerErrorFileDownloadResourceInconsistent response")}}catch(e){_.sendTraceTag(510251346,m.msoulscat_Wac_PptSession,h.Error,"PodsProxy:getItems exception trying to check ServerErrorFileDownloadResourceInconsistent")}return i.data=c,i}async readResponseStream(e,t){let r=new Uint8Array(0);try{let s=await e.read();for(;!s.done;){r=new Uint8Array([...r,...s.value]);const o=C.Settings.readNumberOrDefault("hackMaxBytes",-1);if(o>0&&r.length>o)throw r=r.slice(0,o),"hackMaxBytes hit";if(t>0&&r.length===t&&(_.sendTraceTag(545063709,m.msoulscat_Wac_PptSession,h.Info,"PodsProxy::readResponseStream - received length reached content length: "+t),this.m_settings.shouldUseResponseStreamWhenReceivedTotalLength))break;s=await e.read()}}catch(e){return _.sendTraceTag(558465246,m.msoulscat_Wac_PptSession,h.Error,`PodsProxy::readResponseStream - exception ${e}.`),new Uint8Array(0)}return r}generateReportPerfDictionary(e){const t={};return e[l.action]&&(t[l.action]=e[l.action]),e[l.correlationId]&&(t[l.correlationId]=e[l.correlationId]),e[l.server]&&(t[l.server]=e[l.server]),e[l.parser]&&(t[l.parser]=e[l.parser]),e[l.downloadResponse]&&(t[l.downloadResponse]=e[l.downloadResponse]),e[l.usedOutputCache]&&(t[l.usedOutputCache]=e[l.usedOutputCache]),e[l.contentLength]&&(t[l.contentLength]=e[l.contentLength]),t}createPresInfoAndSlideInfoResponse(e,t){let r={itemErrorCodeMap:void 0,itemErrorCategoryMap:void 0,itemUsedOutputCacheMap:void 0,responseErrorCode:a.ErrorRESERVEDSuccess,responseErrorCategory:d.ErrorRESERVEDSuccess,responseIsIntentional:!1,presInfo:void 0,slideInfo:[]};return t[l.createResponse]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()},r={itemErrorCodeMap:e.itemErrorCodeMap,itemErrorCategoryMap:e.itemErrorCategoryMap,responseErrorCode:e.responseErrorCode,responseErrorCategory:e.responseErrorCategory,responseIsIntentional:!1,presInfo:e.data&&e.data.slideAllInfo&&e.data.slideAllInfo.length>0?e.data.slideAllInfo[0]:void 0,slideInfo:e.data&&e.data.slideAllInfo?e.data.slideAllInfo.slice(1):[],usedOutputCache:e.usedOutputCache,itemUsedOutputCacheMap:e.itemUsedOutputCacheMap},t[l.createResponse].end=E.performanceNowTrimmed(),r}async createSlideInfoResponse(e,t){let r={itemErrorCodeMap:void 0,itemErrorCategoryMap:void 0,itemUsedOutputCacheMap:void 0,responseErrorCode:a.ErrorRESERVEDSuccess,responseErrorCategory:d.ErrorRESERVEDSuccess,responseIsIntentional:!1,slideInfo:[]};return t[l.createResponse]={start:E.performanceNowTrimmed(),end:E.performanceNowTrimmed()},await e.then(e=>{r={itemErrorCodeMap:e.itemErrorCodeMap,itemErrorCategoryMap:e.itemErrorCategoryMap,responseErrorCode:e.responseErrorCode,responseErrorCategory:e.responseErrorCategory,responseIsIntentional:!1,slideInfo:e.data&&e.data.slideAllInfo?e.data.slideAllInfo:[],usedOutputCache:e.usedOutputCache,itemUsedOutputCacheMap:e.itemUsedOutputCacheMap}}),t[l.createResponse].end=E.performanceNowTrimmed(),r}async createSlideIdResponse(e){let t={itemErrorCodeMap:void 0,itemErrorCategoryMap:void 0,itemUsedOutputCacheMap:void 0,responseErrorCode:a.ErrorRESERVEDSuccess,responseErrorCategory:d.ErrorRESERVEDSuccess,responseIsIntentional:!1,slideId:[]};return await e.then(e=>{t={itemErrorCodeMap:e.itemErrorCodeMap,itemErrorCategoryMap:e.itemErrorCategoryMap,responseErrorCode:e.responseErrorCode,responseErrorCategory:e.responseErrorCategory,responseIsIntentional:!1,slideId:e.data&&e.data.slideOrder?e.data.slideOrder:[],itemUsedOutputCacheMap:e.itemUsedOutputCacheMap}}),t}async createPresInfoResponse(e){let t={itemErrorCodeMap:void 0,itemErrorCategoryMap:void 0,itemUsedOutputCacheMap:void 0,responseErrorCode:a.ErrorRESERVEDSuccess,responseErrorCategory:d.ErrorRESERVEDSuccess,responseIsIntentional:!1,presInfo:void 0};return await e.then(e=>{t={itemErrorCodeMap:e.itemErrorCodeMap,itemErrorCategoryMap:e.itemErrorCategoryMap,responseErrorCode:e.responseErrorCode,responseErrorCategory:e.responseErrorCategory,responseIsIntentional:!1,presInfo:e.data&&e.data.slideAllInfo&&e.data.slideAllInfo.length>0?e.data.slideAllInfo[0]:void 0,usedOutputCache:e.usedOutputCache,itemUsedOutputCacheMap:e.itemUsedOutputCacheMap}}),t}static logPerf(e){}static ensureISlideInfoFilters(e){return e&&void 0!==e.EnableClustering?e:{EnableClustering:!1,ExportAsImages:!1}}static performanceNowTrimmed(){return Math.round(performance.now())}async createSlideOrderAndSlidesInfoIndexResponse(e){let t={itemErrorCodeMap:void 0,itemErrorCategoryMap:void 0,itemUsedOutputCacheMap:void 0,responseErrorCategory:d.ErrorRESERVEDSuccess,responseErrorCode:a.ErrorRESERVEDSuccess,responseIsIntentional:!1,slideInfo:[],slideId:[]};return await e.then(e=>{t={itemErrorCodeMap:e.itemErrorCodeMap,itemErrorCategoryMap:e.itemErrorCategoryMap,responseErrorCode:e.responseErrorCode,responseErrorCategory:e.responseErrorCategory,responseIsIntentional:!1,slideId:e.data&&e.data.slideOrder?e.data.slideOrder:[],slideInfo:e.data&&e.data.slideAllInfo?e.data.slideAllInfo:[],itemUsedOutputCacheMap:e.itemUsedOutputCacheMap,metadata:e.metadata,usedOutputCache:e.usedOutputCache}}),t}static logPerformanceEntries(e,t){const r=e.getEntriesByType("resource"),s={};for(const e of r){const r=e;if("fetch"!==r.initiatorType)continue;let o=!1;for(const e of t)if(r.name.indexOf(e)>0||r.name.startsWith(e)){o=!0;break}if(o){if(s.name=r.name,s.dateTime=performance.now(),f.ChangeGate.isChangeGateEnabled("PodsProxy.recordPerfTimingUrlParts")){const e=new URL(r.name);s.hostname=e.hostname,s.pathname=e.pathname}s.start=r.startTime,s.redirectStart=r.redirectStart,s.redirectEnd=r.redirectEnd,s.domainLookupStart=r.domainLookupStart,s.domainLookupEnd=r.domainLookupEnd,s.tcpHandshakeStart=r.connectStart,s.tcpHandshakeEnd=r.connectEnd,s.secureConnectionStart=r.secureConnectionStart,s.responseStart=r.responseStart,s.responseEnd=r.responseEnd,s.fetchStart=r.fetchStart,s.requestStart=r.requestStart,"decodedBodySize"in r&&(s.decodedBodySize=r.decodedBodySize),"encodedBodySize"in r&&(s.encodedBodySize=r.encodedBodySize),"transferSize"in r&&(s.transferSize=r.transferSize),Object.keys(s).length>0&&_.sendTraceTag(572379986,m.msoulscat_Wac_PptSession,h.Info,""+JSON.stringify(s))}}}setTimeoutForParsingResponse(e){return window.setTimeout(()=>{_.sendTraceTag(571342915,m.msoulscat_Wac_PptSession,h.Warning,"Parsing didn't finish in the time. "+JSON.stringify(e))},this.m_settings&&this.m_settings.parseResponseTimeout?this.m_settings.parseResponseTimeout:25e3)}objectDictionaryToRequestIdString(e){let t="";for(const r in e)e[r]&&(t=`${t}${r}=${e[r]};`);return t}}E.s_events=new I.EventEmitter,E.s_supportedImageType=[p.ImagePng,p.ImageJpg]}])}));
//# sourceMappingURL=PodsProxy.js.map